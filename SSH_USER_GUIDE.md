# SSH 认证用户指南

## SSH 登录流程说明

当您使用 SSH 公钥登录时，会经历以下步骤：

### 1. 获取 SSH 登录命令

在网页上点击"通过 SSH 登录"后，系统会显示一条 SSH 命令，例如：

```bash
ssh a1b2c3d4@localhost -p 2222
```

### 2. 在终端执行命令

将命令复制到您的终端执行。

### 3. SSH 连接和确认界面

连接成功后，您会看到如下界面：

```
┌────────────────────────────────────────────────────┐
│           SSH 密钥认证服务                         │
│      SSH Key Authentication Service               │
└────────────────────────────────────────────────────┘

✓ SSH 公钥认证成功！
  SSH public key authenticated successfully!

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 鉴权用途 | Purpose: 登录到系统 - 用户: alice
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️  安全提示 | Security Notice:
   此操作将授权使用您的 SSH 公钥进行身份验证。
   This will authorize the use of your SSH public key.

❓ 是否同意此次鉴权请求？
   Do you approve this authentication request?

   输入 y 同意 | Type "y" to approve
   输入其他拒绝 | Type anything else to deny

您的选择 | Your choice: _
```

### 4. 确认或拒绝

#### 同意鉴权

输入 `y` 或 `yes`（不区分大小写），然后按回车：

```
您的选择 | Your choice: y

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 已同意 | Approved
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✓ 鉴权成功！您的 SSH 公钥已被记录。
  Authentication successful!
  Your SSH public key has been recorded.

您现在可以关闭此连接。
You can now close this connection.
```

浏览器会自动完成登录，跳转到仪表板。

#### 拒绝鉴权

输入除 `y`/`yes` 以外的任何内容（如 `n`、`no` 或直接按回车），然后按回车：

```
您的选择 | Your choice: n

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
❌ 已拒绝 | Denied
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✗ 鉴权已取消。
  Authentication cancelled.
```

浏览器会显示"您拒绝了鉴权请求，登录已取消"。

### 5. 取消操作

您也可以随时按 `Ctrl+C` 取消操作。

## 鉴权用途说明

### 什么是鉴权用途？

鉴权用途是说明此次 SSH 认证的目的，帮助您了解：
- 哪个应用正在请求认证
- 请求的具体目的是什么
- 涉及的用户账号信息

### 示例

**登录场景：**
```
📋 鉴权用途 | Purpose: 登录到系统 - 用户: alice
```

**操作场景（其他应用集成）：**
```
📋 鉴权用途 | Purpose: 授权访问 GitHub 仓库 - 项目: myproject
📋 鉴权用途 | Purpose: 签署文档 - 文件: contract.pdf
📋 鉴权用途 | Purpose: 部署应用 - 环境: production
```

### 为什么重要？

鉴权用途帮助您：
1. **识别请求来源** - 知道是哪个应用在请求认证
2. **防止钓鱼攻击** - 识别可疑的认证请求
3. **审计追踪** - 了解 SSH 公钥的使用情况

## 安全建议

### ✅ 应该同意的情况

- 用途说明清晰且符合预期
- 您主动发起的登录/操作请求
- 信任的应用和服务
- 在安全的网络环境中

### ❌ 应该拒绝的情况

- 用途不明确或可疑
- 未主动发起的请求
- 不认识的应用或服务
- 信息与预期不符
- 在公共网络环境中收到意外请求

### 🔒 最佳实践

1. **仔细阅读用途说明** - 确认请求的合法性
2. **验证应用来源** - 确保是从可信的网站发起
3. **注意异常请求** - 警惕频繁或异常的认证请求
4. **定期审查公钥** - 在应用中查看和管理您的 SSH 公钥
5. **使用不同密钥** - 为不同的服务使用不同的 SSH 密钥对

## 常见问题

### Q1: 为什么需要手动确认？

**A:** 这是一项安全措施，确保：
- 您知道正在发生的认证行为
- 防止恶意应用滥用您的 SSH 公钥
- 给您审查和拒绝的机会

### Q2: 输入错误可以修改吗？

**A:** 可以，使用退格键（Backspace）删除输入的字符。

### Q3: 不输入直接按回车会怎样？

**A:** 直接按回车等同于拒绝，认证会被取消。

### Q4: 可以设置自动同意吗？

**A:** 当前版本不支持，这是为了安全考虑。未来版本可能添加"信任的应用"功能。

### Q5: SSH 连接后多久会自动断开？

**A:** 确认或拒绝后 2 秒内会自动断开连接。

### Q6: 验证码有效期多久？

**A:** 验证码有效期为 5 分钟，超时需要重新获取。

### Q7: 拒绝后可以重试吗？

**A:** 可以，在浏览器重新点击"通过 SSH 登录"获取新的验证码。

### Q8: 为什么有时看到的用途是"未指定用途"？

**A:** 这表示应用没有提供用途说明。建议谨慎对待此类请求，或联系应用开发者补充用途信息。

## 故障排除

### 问题：排版错乱或乱码

**可能原因：**
- 终端不支持 UTF-8 编码
- 终端窗口太小

**解决方案：**
1. 确保终端支持 UTF-8 编码
2. 调整终端窗口大小（建议至少 80 列）
3. 使用现代终端模拟器（如 Windows Terminal、iTerm2）

### 问题：无法输入

**可能原因：**
- 终端未正确连接

**解决方案：**
1. 检查 SSH 连接是否成功
2. 确认看到完整的提示界面
3. 尝试按任意字母键测试输入

### 问题：输入 y 后没有反应

**可能原因：**
- 忘记按回车键

**解决方案：**
- 输入 `y` 后必须按回车键确认

## 技术细节

### 支持的确认输入

**同意：**
- `y` (推荐)
- `yes`
- `Y`
- `YES`

**拒绝：**
- 任何其他输入
- 直接按回车
- `n`、`no` 等

### 特殊按键

- **退格键 (Backspace/Delete)** - 删除字符
- **回车键 (Enter)** - 确认输入
- **Ctrl+C** - 取消操作

### 状态码

| 状态 | 说明 | 浏览器行为 |
|------|------|-----------|
| `success` | 用户同意并完成认证 | 自动登录 |
| `denied` | 用户拒绝认证 | 显示错误消息 |
| `expired` | 验证码过期 | 提示重新获取 |
| `pending` | 等待用户操作 | 继续轮询 |

---

**安全提示：** 请妥善保管您的 SSH 私钥，永远不要与他人分享！

